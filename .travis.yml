os: linux
dist: bionic
language: shell

# safelist
branches:
  only:
    - master
    - /^feature/(.)*$/
    - /^hotfix/(.)*$/
    - /^develop/(.)*$/

env:
  jobs:
    - DISTRO=ubuntu1804  ANSIBLE_VER=ansible28
    - DISTRO=ubuntu1804  ANSIBLE_VER=ansible29
    - DISTRO=ubuntu2004  ANSIBLE_VER=ansible28
    - DISTRO=ubuntu2004  ANSIBLE_VER=ansible29

before_install:
  - |
    sudo apt-get update
    sudo apt-get install lxd lxd-tools qemu-block-extra python3 python3-pip python3-setuptools
    sudo lxd init --auto
    sudo usermod -aG lxd $(whoami)
    sudo pip3 install tox

script: 
  - |
    sudo tox -e ${DISTRO}-${ANSIBLE_VER}
